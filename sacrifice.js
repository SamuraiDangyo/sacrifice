/*
sacrifice. Lightweight JSON library written in vanilla JavaScript
Copyright (C) 2020 Toni Helminen

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
*/
!function(){"use strict";const t=0,e=1,r=2,s=3,i=4,n=5,h=6,o=7,u=8,l=9,c=10,p=[[r,"["],[s,"]"],[t,"{"],[e,"}"],[n,","],[i,":"]],a=/[-+]?\d*\.?\d+([eE][-+]?\d+)|[+-]?\d*\.?\d+/,k={errors:!1,errorMsg:0};class f{constructor(){this.errors=k.errors=!1,this.errorMsg=k.errorMsg="..."}error(t="..."){return this.errors=k.errors=!0,this.errorMsg=k.errorMsg=t,this}}class d extends f{constructor(t){super(),this.tokens=[],this.counter=0,this.str=t,this.parse()}add(t,e=0){this.tokens.push({tokenId:t,tokenValue:e})}tokenOne(){for(const t of p)if(t[1]===this.str[this.counter])return this.counter++,this.add(t[0],t[1]),!0;return!1}tokenString(){if('"'===this.str[this.counter]){this.counter++;let t="";for(;this.counter<this.str.length;){const e=this.str[this.counter];if(this.counter++,'"'===e){this.add(c,t);break}t+=e}return!0}return!1}tokenWhitespace(){return!!/^\s/.test(this.str[this.counter])&&(this.counter++,!0)}tokenNull(){return!!/^null/.test(this.str.slice(this.counter))&&(this.counter+=4,this.add(h,"null"),!0)}tokenTrue(){return!!/^true/.test(this.str.slice(this.counter))&&(this.counter+=4,this.add(o,"true"),!0)}tokenFalse(){return!!/^false/.test(this.str.slice(this.counter))&&(this.counter+=5,this.add(u,"false"),!0)}tokenNumber(){const t=a.exec(this.str.slice(this.counter));return null!==t&&(this.add(l,t[0]),this.counter+=t[0].length,!0)}trim(){let t="";for(let e=0;e<this.tokens.length;e++)t+=this.tokens[e].tokenId===c?`"${this.tokens[e].tokenValue}"`:this.tokens[e].tokenValue;return t}debugTokens(){for(let t=0;t<this.tokens.length;t++)console.log(t,this.tokens[t])}parse(){if("string"!=typeof this.str)return this.error("Illegal input");for(;this.counter<this.str.length&&!this.errors;)if(!(this.tokenWhitespace()||this.tokenNull()||this.tokenTrue()||this.tokenFalse()||this.tokenOne()||this.tokenString()||this.tokenNumber()))return this.error(`Illegal character: "${this.str[this.counter]}"`);return this}}class g extends f{constructor(t){if(super(),this.position=0,this.result=0,this.tokenizer=new d(t),this.tokens=this.tokenizer.tokens,this.tokenizer.errors)return this.tokenizer;this.parse()}peek(t,e=0){return this.position+e<this.tokens.length&&this.tokens[this.position+e].tokenId===t}expect(t){return this.good()&&this.current().tokenId===t?this:this.error(`Expected: '${t}' but found: "${this.current().tokenValue}"`)}good(){return this.position<this.tokens.length}current(){return this.tokens[this.position]}step(){return this.position++,this}addObject(t,e){this.peek(o)?(t[e]=!0,this.step()):this.peek(u)?(t[e]=!1,this.step()):this.peek(h)?(t[e]=null,this.step()):this.peek(c)?(t[e]=this.current().tokenValue,this.step()):this.peek(l)?(t[e]=parseFloat(this.current().tokenValue),this.step()):t[e]=this.parseTokens()}createObject(){if(this.errors)return this;let r={},s=!1;for(this.expect(t).step();this.good();){if(this.errors)return this;if(this.peek(e))return s?this.error("Illegal token"):(this.step(),r);this.expect(c);const t=this.current().tokenValue;if(this.step().expect(i).step(),s=!1,this.addObject(r,t),!this.peek(e)&&!this.peek(n))return this.error("Illegal token");this.peek(n)&&(s=!0,this.step())}return this.error("Illegal token")}addArray(e){if(this.peek(h))e.push(null),this.step();else if(this.peek(u))e.push(!1),this.step();else if(this.peek(o))e.push(!0),this.step();else if(this.peek(c))e.push(this.current().tokenValue),this.step();else if(this.peek(l))e.push(parseFloat(this.current().tokenValue)),this.step();else if(this.peek(t))e.push(this.createObject());else{if(!this.peek(r))return!1;e.push(this.createArray())}return!0}createArray(){if(this.errors)return this;let t=[],e=!1;for(this.expect(r).step();this.good();){if(this.peek(s))return e?this.error("Illegal token"):(this.step(),t);if(e=!1,!this.addArray(t))return this.error("Illegal token");if(!this.peek(s)&&!this.peek(n))return this.error("Illegal token");this.peek(n)&&(e=!0,this.step())}return this.error("Illegal token")}parseTokens(){if(this.errors)return this;if(this.peek(t))return this.createObject();if(this.peek(r))return this.createArray();if(this.peek(o))return this.step(),!0;if(this.peek(u))return this.step(),!1;if(this.peek(h))return this.step(),null;if(this.peek(c)){const t=this.current().tokenValue;return this.step(),t}if(this.peek(l)){const t=parseFloat(this.current().tokenValue);return this.step(),t}return this.error("Illegal JSON")}parse(){return this.errors?this:(this.result=this.parseTokens(),this.position<this.tokens.length?this.error("Illegal JSON"):this)}}class y extends f{constructor(t){super(),this.json=t,this.result=0,this.parse()}createObject(t){if(this.errors)return this;let e="{",r=!1;const s=Object.keys(t);for(const i of s)e+=(r?",":"")+`"${i}":`+this.convert(t[i]),r=!0;return e+"}"}createArray(t){if(this.errors)return this;let e="[",r=!1;for(const s of t)e+=(r?",":"")+this.convert(s),r=!0;return e+"]"}convert(t){return null===t?"null":!1===t?"false":!0===t?"true":Array.isArray(t)?this.createArray(t):"number"==typeof t?t:"object"==typeof t?this.createObject(t):"string"==typeof t?`"${t}"`:this.error("Illegal JSON object")}parse(){this.result=this.convert(this.json)}}k.trim=function(t){const e=new d(t);return e.errors?void 0:e.trim()},k.parse=function(t){if(Array.isArray(t))return k.parse(t[0]);if("string"!=typeof t)return t;const e=new g(t);return e.errors?void 0:e.result},k.stringify=function(t){const e=new y(t);return e.errors?void 0:e.result},k.validate=function(t){return!new g(t).errors},k.version=function(){return"sacrifice 1.04 by Toni Helminen"},window.sacrifice=k}();
